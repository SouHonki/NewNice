
# 云游戏行业现状及未来展望

## 一、背景及现状
### 云游戏的概念
**云游戏** 是指游戏在服务端运行，将结果通过网络实时传输给客户端展示，客户端设备只需进行视频解码。    
云游戏为游戏产业的未来提供了很多想象的空间：
* 游戏既点既玩，无需等待下载、安装、升级；
* 用户可在低配置设备上畅玩3A级大型游戏；
* 在游戏过程中遇到需要外出等情况，可无缝切换客户端；
* 游戏中可远程实现高玩代打等。

### 云游戏的历史
云游戏的概念至今已有二十年的历史：
* 2005年，游戏开发商Crytek开始为《孤岛危机》开发云游戏系统，但受网络和基础设施限制，最终停止开发。    
* 2009年，在旧金山GDC游戏开发者大会上，Steve Perlman展示了OnLive云游戏平台，演示了对硬件配置要求较高的游戏《孤岛危机》。此后，EA 、Ubisoft、Vlave和Bethesda 等著名游戏厂商均有意寻求与OnLive的合作。    
* 2012年，Sony公司收购云游戏公司Gaikai（成立于2008年），并于2014年推出云游戏服务 PlayStation Now。    
* 2018年，微软Xbox公开了云游戏计划：Project xCloud，通过该串流服务用户可以在任意终端玩到Xbox上的游戏。同年，任天堂Switch Online正式上线。    
* 2019年，谷歌发布Stadia平台（https://www.stadia.dev ）， 并与Unreal和Unity达成合作，后续计划推出行业标准工具和中间件。同年，腾讯START云游戏平台（https://start.qq.com ）开始公测，目前可测试区域： 广东、上海、北京、江苏、天津、河北、安徽、重庆、四川、福建、山东、湖南。

### 国内云游戏现状
当下中国云游戏市场呈现出繁荣的景象，诸多公司纷纷开始尝试。  
但不同于上述自行研发云游戏平台的公司，国内的云游戏行业呈现出流量入口、游戏CP及云服务商三方合作的景象。  
流量入口提供用户资源，云服务商提供云计算的能力，将传统游戏上架转化为云端运行的游戏。  

国内云游戏领域发展最快的是 **云手游**，主要原因：
* 世界游戏产业收入近半数由手游贡献；
(根据Newzoo发布的《2019年全球游戏市场报告》：
2019年，全球移动游戏市场收入将为685亿美元，占全球游戏市场规模的45%。其次是主机游戏市场的479亿美元，占全球游戏市场规模的32%。第三大细分市场是PC游戏，预计收入357亿美元，占全球游戏市场规模的23%。)
* 游戏玩家中大多数为手游玩家且占比有上升趋势；
* 手游云化的成本较低，实现速度快；

**云手游** 主要的应用场景如下：
* **低端机畅玩大型游戏**  
在低配的手机、电脑、机顶盒或智能电视上玩大型手游；
* **游戏秒玩**  
用户无需下载安装即可随时体验感兴趣的游戏；
* **互动视频广告**  
在观看游戏视频广告的同时，可参与其中，进行操作；
* **账号交易验货**  
用户在游戏账号交易时，可远程试用账号进行验货，同时可保证卖家的账号安全；


## 二、Stadia测评
谷歌在2019年发布了Stadia平台后，社会各界对云游戏呈现了空前的热情，很多企业认为云游戏必将成为游戏行业的未来。  
游戏玩家及游戏厂商纷纷对Stadia进行了各种角度的测评。  
 ***TODO:*** 大体结论如下




## 三、架构及技术分析
通过体验及综合分析上述云游戏服务，云游戏的整体交互流程如下图（只关心云游戏核心架构，忽略额外的业务场景，如：支付、用户管理等）。

![](src/cloudgaming.png)
<!--
<img src="cloudplay1.png" width="80%">
-->

### 名词解释
* **客户端**  
播放游戏画面和声音、获取用户输入的软硬件。  
可以一个客户端独立负责音视频和输入（如：移动端、PC端等），也可以多个客户端分工配合（如：TV端负责播放画面、手柄端负责获取用户输入）。  
* **调度服务**  
负责处理整个服务周期中所有客户端请求，并能够推送消息到客户端。  
* **节点**  
分布式边缘计算节点，提供并管理云游戏计算资源，处理调度服务发来的请求。  
* **流服务**  
每个节点内提供的服务，负责音视频编码及传输。推送游戏画面到客户端，同时获取客户端的输入操作。  

### 流程简述
* **申请云游戏**  
 **1:** 客户端申请云游戏，申请参数中携带了客户端信息、游戏信息、播流参数等；  
 **2 ~ 3:** 调度服务根据路由策略（可动态配置）选择合适的服务节点，并通知该节点准备服务资源；  
 **4 ~ 6:** 节点收到通知后，开始准备计算资源，及流服务资源；  
 **7 ~ 9:** 游戏及流服务准备完毕，将流地址推送给客户端；  
 **10 ~ 11:** 客户端收到流地址后，与流服务建立连接；  
 **12 ~ 14:** 流服务负责将原始游戏画面进行音视频编码，并传输到客户端；  
 **15:** 客户端进行音视频解码，渲染画面、播放音频；  
 **16 ~ 17:** 用户通过客户端进行输入操作，通过流服务传输到节点；  
 **18:** 节点处理用户输入，计算出相应的画面，回到12，开始循环。  
 *说明： 15和16中的客户端可能是同一个端（如：PC端或手机端，同时负责画面和输入），
 也可能是不通的端（如：画面渲染在TV端，而输入是手柄端）。*
* **释放云游戏**  
 **1 ~ 2:** 用户结束游戏，客户端通知调度服务，调度服务通知节点；  
 **3:** 节点进行状态保存，如：保存用户存档、用户配置等信息；  
 **4 ~ 7:** 节点释放流服务，资源全部回收完毕，结束整个流程。


### 核心技术分析
#### 云游戏服务器
目前有两种主流解决方案：
* **基于ARM的云游戏服务器**  
具有功耗低，硬件成本低，移动端游戏兼容性良好等特点。  
华为Taishan服务器（使用鲲鹏处理器）便是基于ARM指令集的高性能服务器。  
PC端游戏若要运行在ARM服务器上，则需要重新编译甚至二次开发。  
* **基于X86的云游戏服务器**  
性能强，技术发展成熟，但功耗高，硬件成本高。  
移动端游戏若要运行在X86服务器上，需要二次开发或运行虚拟机（这将浪费大量计算资源）。  
因此，基于X86的服务器，更适合运行PC游戏或主机游戏。  

#### 流服务
目前直播领域使用最多的是基于TCP的RTMP协议。而云游戏的流服务与直播业务类似，因此部分云游戏厂商选择了RTMP协议进行音视频传输。  
RTMP协议实现相对简单，CDN厂商支持良好。但其缺点也较为明显：  
1. 基于TCP，传输成本高，弱网环境表现不佳；  
2. 不支持浏览器推送；  
3. Adobe私有协议，已不再更新。  

而谷歌的流服务解决方案是 BBR+QUIC+WebRTC，整套方案均为谷歌自研的开源方案。  
底层基于UDP，弱网环境下有很大优化空间，对主流浏览器有较好支持。  
但目前CDN厂商对WebRTC支持较差，需要自建CDN或要求CDN厂商定制。  

## 四、现存问题讨论
伴随着互联网巨头的加入，云游戏在近些年获得长足发展，
但依然存在着若干问题，导致其无法迅速迅速抢占传统游戏的市场。  
游戏玩家最重视的是游戏的体验和价格，从这两方面看云游戏尚不具备替代传统游戏的优势。

* **体验方面**  
在当前网络基础设施情况下，云游戏的体验定然无法与本地游戏相媲美。   
首先，云游戏对网络带宽的要求较高，这导致网络环境普通甚至弱网的情况下，用户体验极差。如：索尼的PlayStation Now需要12Mbps的网速才能流程运行，低于这一条件，几乎无法使用。  
此外，受机房及网络等设施影响，当前云游戏对国家/地区的覆盖范围有限。如：PlayStation Now仅支持北美地区，Switch Online仅支持日本地区。

* **成本方面**  
云游戏的一大优势在于配置较差的客户端可以运行大型游戏。这实际上是云游戏服务器承担了大量的计算开销，因此云游戏业务需要在节点中投入大量的计算资源。  
同时，由于游戏玩家对画质和实时性的要求远高于直播用户，云游戏业务需要提供的带宽资源也远高于直播业务。  
如果将订阅或买断云游戏的价格降低到用户可接受的范围，高昂的带宽和计算成本将成为大多数厂商的噩梦。

此外，游戏内容的生产及版权等，也是云游戏未来将要面对的主要问题之一。  
索尼、微软、任天堂等公司均有深厚的游戏内容储备，腾讯也有一定的积累，谷歌也已成立了自己的游戏工作室进行游戏研发。


## 五、未来发展趋势探讨
纵观云游戏的发展历程，其核心技术和挑战主要有以下两方面：  
1.游戏云化；  
2.音视频编解码及传输；  
 ***TODO:*** 下面主要从技术角度讨论这两个问题。  
**游戏云化**  
* 现有游戏的移植  
* 全新云游戏开发平台建设   

**音视频编解码及传输**    
* 5G网络支持
* 运算成本及传输延迟问题
* 边缘节点建设


## 参考文献
<!--
深入了解云游戏: https://www.bilibili.com/read/cv5537097/  
-->
云游戏启航: http://www.gamelook.com.cn/2020/04/382736  
对话红手指: https://www.tmtpost.com/4147096.html  
BBR: https://blog.csdn.net/dog250/article/details/52830576  
Quic: https://www.zhihu.com/topic/20016701/hot  
WebRTC: https://webrtc.org.cn/  

Cloud gaming: architecture and performance  
Next Generation Mobile Cloud Gaming  
GameSpot: Cloud Gaming Is The Next Big Thing; Here's Everything You Need To Know  
PCGamer: What you need to know about the current state of cloud gaming?  
